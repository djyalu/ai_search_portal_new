# 처리 성능 획기적 개선 제안

## 0. 목적
현 구조에서 **체감 성능을 크게 개선**하기 위해 구조적 최적화 방안을 정리한다.  
단일 튜닝보다 “병렬화 + 재사용 + 조기 종료 + 실패 비용 감소”의 결합이 핵심이다.

## 1. 성능 병목 가설
1) 에이전트별 순차 수집으로 총 시간이 합산됨
2) 매 요청마다 `newPage()`/`goto()`로 초기화 비용이 반복됨
3) 스트리밍 종료 판단이 늦어 수집 루프가 과도하게 길어짐
4) 실패 재시도 비용이 크고, 원인 파악이 느림

## 2. 획기적 개선안 (우선순위)

### 2.1 병렬 수집 + 동시성 풀 (가장 큰 효과)
- 에이전트 수집을 **병렬**로 전환
- 사이트별 rate limit을 고려한 **동시성 풀(2~3)** 적용
- 기대 효과: 총 처리 시간 ≈ 최장 에이전트 시간에 근접

### 2.2 탭/컨텍스트 재사용 (대폭 단축)
- 에이전트별 탭을 풀링해 재사용
- 매 요청마다 `newPage()`/`goto()` 비용 제거
- 로그인 세션 유지로 재인증 비용 최소화

### 2.3 수집 조기 종료 룰 (체감 개선)
- “길이 증가율 + 2회 동일 텍스트” 기준으로 즉시 종료
- 불필요한 수집 루프 제거

### 2.4 리소스 차단 + 도메인 화이트리스트
- 이미지/폰트/미디어 차단 → 로딩 시간 단축
- 핵심 도메인만 통과 → 네트워크 비용 절감

### 2.5 분석 단계 단순화
- Logic/Polish 단계 **단일 에이전트 고정**
- 반복 프롬프트 캐싱으로 처리 시간 절감

### 2.6 실패 비용 절감
- 입력 성공 검증 후 1~2회 재시도
- 실패 스냅샷 자동 저장으로 원인 분석 시간 단축

## 3. 적용 순서 (추천)
1) 병렬 수집 + 동시성 풀
2) 탭/컨텍스트 재사용
3) 수집 조기 종료 룰
4) 리소스 차단 + 도메인 화이트리스트
5) 분석 단계 단순화
6) 실패 스냅샷 자동 저장

## 4. 성공 지표 (KPI)
- 평균 처리 시간 40~60% 단축
- 에이전트별 수집 실패율 50% 이상 감소
- 재시도 횟수 1회 이하 유지

## 5. 기대 효과
- 체감 속도 개선 (보고서 생성 시간 단축)
- 불필요한 대기/재시도 감소
- 안정성 향상으로 운영 비용 절감
