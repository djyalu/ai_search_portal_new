# 분석 속도 대폭 개선 방안

작성일: 2026-02-01
대상: AI Search Portal (Multi‑GPT Analyzer)
목표: End‑to‑End 분석 시간 40~60% 단축, 실패 재시도 비용 최소화

---

## 1) 병목 요약
- **초기 전송 지연**: 에이전트별 탭 로딩 + 로그인 상태 확인 지연
- **수집 대기**: 응답 스트리밍 안정화 대기 시간이 과도함
- **Perplexity 계획 단계**: Reasoning 단계가 전체 지연을 유발
- **재시도 비용**: 실패 시 전체 루프 재실행으로 시간 낭비

---

## 2) 핵심 개선안 (우선순위)

### A. Reasoning 단계 비동기/감축 (P1)
- Perplexity 계획 단계는 **최대 8~10초**로 제한
- 타임아웃 시 **즉시 기본 전략으로 진행**
- Reasoning 결과를 **캐시**하여 동일 질문 재사용

**기대 효과**: 평균 10~20초 단축

---

### B. 수집 루프 조기 종료 조건 고도화 (P1)
- `stableCount` 기준: 에이전트별 응답 길이에 따라 동적 조정
- **응답 완성 조건**: 마침표/문단 종료 + 길이 기준 충족 시 즉시 종료
- Gemini/Claude는 `Stop 버튼 사라짐` + `응답 노드 존재` 조건 활용

**기대 효과**: 에이전트별 평균 5~15초 단축

---

### C. 에이전트 병렬 파이프라인 재설계 (P1)
- Dispatch 단계 **동시성 제한 3→4** 확대
- Collect 단계 **동시성 4 고정** 유지
- Perplexity를 **Dispatch 병렬화**하여 Reasoning과 겹치게 실행

**기대 효과**: 병렬 처리 효율 15~20% 향상

---

### D. Warm‑Up 사전 로딩 최적화 (P2)
- 브라우저 컨텍스트 재사용 유지 + 탭 사전 로딩
- user_data 기반 세션 캐시 유지
- 각 탭에 **상태 체크 최소화(단일 셀렉터 확인)**

**기대 효과**: 초기 전송 지연 5~10초 단축

---

### E. 실패 최소화 및 재시도 비용 절감 (P2)
- 수집 실패 시 **동일 탭 재시도 1회**
- 실패 원인이 `short/noisy`일 때만 재시도
- 실패 사유별 **빠른 탈출**로 전체 재실행 방지

**기대 효과**: 실패 발생 시 평균 30~40% 시간 절약

---

## 3) 코드 구현 방향

### 3.1 Reasoning 타임아웃 + 캐시
- `runExhaustiveAnalysis` 내 Reasoning 단계에 TTL 캐시 추가
- 10초 내 미응답 시 기본 전략으로 fallback

### 3.2 동적 종료 조건
- `collectResult`에서 `minLength` + `isCompleteResponse` 검사
- `isCompleteResponse`는 문장 종결/문단 여부 기반

### 3.3 동시성 상향
- Dispatch pool: 3 → 4
- Collect pool: 4 유지 (CPU 부담 없음)

---

## 4) 적용 순서 제안
1) Reasoning 단계 제한 + 캐시 (P1)
2) 수집 루프 조기 종료 조건 추가 (P1)
3) Dispatch 동시성 상향 (P1)
4) 실패 재시도 제한 도입 (P2)
5) Warm‑Up 최적화 개선 (P2)

---

## 5) 검증 체크리스트
- [ ] `verify_all.js` 3회 연속 성공
- [ ] 평균 End‑to‑End 분석 시간 40% 이상 단축
- [ ] Reasoning 단계 시간 10초 이내 유지
- [ ] 재시도 횟수 평균 1회 미만

---

## 부록: 기대 성과 요약
- 전체 분석 시간: 90~120s → 50~70s 예상
- 재시도 비용: 최대 40% 절감
- 운영 안정성: 실패 후 복구 시간 단축

